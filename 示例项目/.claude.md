# 项目工程规范

## Git工作流

### 分支策略
- `main`: 生产环境代码，只接受来自`develop`的合并
- `develop`: 开发主分支，集成分支
- `feature/*`: 新功能分支，从`develop`创建
- `fix/*`: Bug修复分支
- `hotfix/*`: 紧急修复，从`main`创建

### 提交规范
使用约定式提交（Conventional Commits）：

```
<type>(<scope>): <subject>

<body>

<footer>
```

**类型（type）:**
- `feat`: 新功能
- `fix`: Bug修复
- `docs`: 文档更新
- `style`: 代码格式（不影响功能）
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 构建/工具/依赖

**示例:**
```
feat(auth): 实现OAuth2登录

- 集成Google OAuth2提供商
- 添加JWT token生成逻辑
- 更新用户模型以支持第三方登录

Closes #123
```

### 提交前检查
运行以下命令确保代码质量：
```bash
npm run lint
npm run type-check
npm test
```

## CI/CD流程

### 自动化检查
所有Pull Request会自动执行：
1. ESLint代码检查
2. TypeScript类型检查（如适用）
3. 单元测试
4. 构建验证
5. 安全扫描

### 部署流程
- `develop`分支合并 → 自动部署到测试环境
- `main`分支合并 → 自动部署到生产环境（需手动批准）

## 代码质量标准

### 测试覆盖率
- 新功能必须包含测试
- 单元测试覆盖率不低于80%
- 关键业务逻辑覆盖率需达到100%

### 代码规范
- 遵循ESLint规则
- 使用Prettier格式化
- 所有公共API需要JSDoc注释

### TypeScript（如适用）
- 严格模式开启
- 避免使用`any`类型
- 公共接口必须定义类型

## 环境配置

### 本地开发
```bash
# 安装依赖
npm ci

# 运行开发服务器
npm run dev

# 运行测试
npm test

# 代码检查
npm run lint
```

### 环境变量
- `.env.local`: 本地开发环境变量（不提交）
- `.env.example`: 环境变量模板（需提交）

## 依赖管理

### 版本锁定
- 使用`package-lock.json`锁定依赖版本
- 定期更新依赖：`npm audit fix`
- 重大版本更新需要团队review

### 依赖分类
- `dependencies`: 生产依赖
- `devDependencies`: 开发依赖
- `peerDependencies`: 对等依赖

## 文档规范

### README.md
必须包含：
- 项目简介
- 安装步骤
- 使用示例
- 开发指南

### 代码注释
- 复杂逻辑必须有注释
- 函数参数和返回值需要说明
- 使用JSDoc格式

## 与Claude协作指南

### 代码生成请求
当请求Claude生成代码时，需要明确：
1. 功能需求
2. 测试要求
3. 代码规范要求

### 代码审查
Claude生成的代码需要：
1. 运行测试验证
2. 通过Lint检查
3. 遵循项目代码规范
4. 提交前在本地完整测试

### 问题排查
如遇到问题：
1. 检查Git历史：`git log`
2. 查看CI/CD日志
3. 对比本地和CI环境差异
