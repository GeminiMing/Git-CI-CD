# 完整流程演示指南

## 🎯 演示目标
通过实际操作，展示从零开始到CI/CD运行的完整工程实践流程。

## 📁 项目结构

```
demo-project/
├── src/                    # 源代码
│   ├── index.js           # 主入口
│   └── utils/             # 工具模块
│       ├── greeting.js    # 问候函数
│       ├── calculator.js  # 计算器类
│       └── validator.js   # 验证工具
├── tests/                 # 测试文件
│   ├── greeting.test.js
│   ├── calculator.test.js
│   └── validator.test.js
├── scripts/               # 构建脚本
│   └── build.js
├── .github/
│   └── workflows/
│       └── ci.yml         # CI/CD配置
├── package.json           # 项目配置
├── .eslintrc.json         # ESLint配置
├── .prettierrc.json       # Prettier配置
├── jest.config.js         # Jest配置
├── .claude.md             # 项目规范文档
├── README.md              # 项目说明
├── 演示流程.md            # 详细流程说明
└── 快速开始.sh            # 自动化演示脚本
```

## 🚀 快速开始（3步）

### 1. 进入项目目录
```bash
cd demo-project
```

### 2. 运行自动化脚本
```bash
./快速开始.sh
```

脚本会自动执行：
- ✅ 安装依赖
- ✅ 运行测试
- ✅ 代码质量检查
- ✅ 构建验证
- ✅ 生成覆盖率报告

### 3. 查看结果
```bash
# 查看测试覆盖率报告（macOS）
open coverage/lcov-report/index.html

# 或者运行项目
npm start
```

## 📖 详细流程演示

### 阶段1：项目初始化（已完成）

项目已包含：
- ✅ 完整的项目结构
- ✅ 示例代码和测试
- ✅ 代码质量工具配置
- ✅ CI/CD配置

### 阶段2：本地开发流程

#### 2.1 安装依赖
```bash
cd demo-project
npm ci
```

#### 2.2 运行测试
```bash
# 运行所有测试
npm test

# 监视模式（开发时使用）
npm run test:watch

# 查看覆盖率
npm run test:coverage
```

**预期输出：**
```
PASS  tests/greeting.test.js
PASS  tests/calculator.test.js
PASS  tests/validator.test.js

Test Suites: 3 passed, 3 total
Tests:       16 passed, 16 total
```

#### 2.3 代码质量检查
```bash
# Lint检查
npm run lint

# 自动修复
npm run lint:fix

# 格式检查
npm run format:check

# 自动格式化
npm run format
```

#### 2.4 运行项目
```bash
npm start
```

**预期输出：**
```
👋 欢迎使用 Claude CI/CD Demo!

计算器演示:
  10 + 5 = 15
  10 - 5 = 5
  10 * 5 = 50
  10 / 5 = 2

邮箱验证演示:
  test@example.com: ✓ 有效
  invalid-email: ✗ 无效
  user@domain.co.uk: ✓ 有效
```

### 阶段3：Git工作流演示

#### 3.1 初始化Git仓库（如果还没有）
```bash
cd demo-project
git init
git checkout -b develop
```

#### 3.2 查看项目状态
```bash
git status
```

#### 3.3 创建初始提交
```bash
# 添加所有文件
git add .

# 创建提交（使用约定式提交格式）
git commit -m "chore: 初始化CI/CD演示项目

- 添加项目基础结构和示例代码
- 配置ESLint、Prettier、Jest
- 添加完整的测试用例
- 配置GitHub Actions CI流程
- 添加项目文档和规范"
```

#### 3.4 查看提交历史
```bash
git log --oneline --graph
```

### 阶段4：功能开发流程演示

#### 4.1 创建功能分支
```bash
git checkout -b feature/add-power-function
```

#### 4.2 添加新功能
编辑 `src/utils/calculator.js`，添加幂运算方法：

```javascript
/**
 * 幂运算
 * @param {number} base - 底数
 * @param {number} exponent - 指数
 * @returns {number} 结果
 */
power(base, exponent) {
  this._validateNumbers(base, exponent);
  return Math.pow(base, exponent);
}
```

#### 4.3 添加测试
编辑 `tests/calculator.test.js`，添加测试用例：

```javascript
describe('power方法', () => {
  test('应该正确计算幂', () => {
    expect(calc.power(2, 3)).toBe(8);
    expect(calc.power(5, 2)).toBe(25);
  });
});
```

#### 4.4 验证功能
```bash
# 运行测试
npm test

# 代码检查
npm run lint

# 运行项目验证
npm start
```

#### 4.5 提交代码
```bash
git add src/utils/calculator.js tests/calculator.test.js
git commit -m "feat(calculator): 添加幂运算功能"
```

#### 4.6 合并到develop
```bash
git checkout develop
git merge feature/add-power-function --no-ff
```

### 阶段5：CI/CD流程演示

#### 5.1 查看CI配置
```bash
cat .github/workflows/ci.yml
```

#### 5.2 本地模拟CI流程
```bash
# 运行完整的CI检查
npm run lint && npm test && npm run build
```

#### 5.3 GitHub Actions（需要推送后自动触发）

如果项目已推送到GitHub，CI会自动运行：

1. **Push到分支** → 触发CI
2. **创建Pull Request** → 触发CI检查
3. **查看CI结果** → GitHub Actions页面

CI会执行：
- ✅ Lint检查
- ✅ 格式检查  
- ✅ 测试（Node.js 18和20）
- ✅ 构建验证

### 阶段6：代码审查流程

#### 6.1 创建Pull Request

```bash
# 推送到远程（假设已配置远程仓库）
git push origin feature/add-power-function
```

在GitHub上：
1. 创建Pull Request
2. 填写PR描述
3. CI自动运行检查
4. 等待代码审查
5. 审查通过后合并

#### 6.2 PR检查清单

- [ ] CI检查通过
- [ ] 测试覆盖率达标
- [ ] 代码符合规范
- [ ] 提交信息规范
- [ ] 功能正常工作

## 🎓 实战练习建议

### 练习1：添加新功能
**任务：** 为计算器添加 `sqrt`（平方根）方法

**步骤：**
1. 创建分支：`git checkout -b feature/add-sqrt`
2. 实现功能代码
3. 编写测试
4. 运行所有检查
5. 提交代码

### 练习2：修复Bug
**任务：** 修复一个假设的bug

**步骤：**
1. 创建分支：`git checkout -b fix/calculator-bug`
2. 重现问题
3. 编写失败的测试（TDD）
4. 修复代码
5. 验证测试通过

### 练习3：重构代码
**任务：** 重构现有代码，提高可读性

**步骤：**
1. 确保所有测试通过
2. 重构代码（不改变功能）
3. 确保测试仍然通过
4. 检查代码质量

## 📊 项目质量指标

运行以下命令查看项目质量：

```bash
# 测试覆盖率
npm run test:coverage

# 代码质量
npm run lint

# 构建状态
npm run build
```

## 🔧 故障排查

### 问题：测试失败
```bash
# 查看详细错误信息
npm test -- --verbose

# 运行单个测试文件
npm test tests/calculator.test.js
```

### 问题：Lint错误
```bash
# 查看具体错误
npm run lint

# 自动修复
npm run lint:fix
```

### 问题：依赖安装失败
```bash
# 清理后重新安装
rm -rf node_modules package-lock.json
npm install
```

## 📚 延伸学习

1. **Git高级功能**
   - rebase vs merge
   - cherry-pick
   - interactive rebase

2. **CI/CD进阶**
   - 多环境部署
   - Docker集成
   - 性能测试

3. **代码质量工具**
   - SonarQube
   - Codecov
   - Semantic Release

4. **团队协作**
   - 代码审查最佳实践
   - 分支策略选择
   - 发布流程

## ✅ 检查清单

在分享或演示前，确认：

- [ ] 项目可以正常安装依赖
- [ ] 所有测试通过
- [ ] 代码质量检查通过
- [ ] CI配置正确
- [ ] 文档完整清晰
- [ ] 示例代码可运行

---

**提示：** 在实际演示时，可以现场修改代码、运行测试、触发CI流程，让观众看到完整的反馈循环。
